### YamlMime:PowershellCmdlet
summary: |-
  Stops a PEF Trace Session.
module: PEF
notes: ""
links:
- text: Add-PefMessageSource
  href: ./Add-PefMessageSource.yml
- text: New-PefDateTimeTrigger
  href: ./New-PefDateTimeTrigger.yml
- text: New-PefKeyDownTrigger
  href: ./New-PefKeyDownTrigger.yml
- text: New-PefMessageTrigger
  href: ./New-PefMessageTrigger.yml
- text: New-PefProcessTrigger
  href: ./New-PefProcessTrigger.yml
- text: New-PefTimeSpanTrigger
  href: ./New-PefTimeSpanTrigger.yml
- text: New-PefTraceSession
  href: ./New-PefTraceSession.yml
- text: Save-PefDataCollection
  href: ./Save-PefDataCollection.yml
- text: Start-PefTraceSession
  href: ./Start-PefTraceSession.yml
syntaxes:
- Stop-PefTraceSession [-PEFSession] <IPpkTraceSession> [-Trigger <Trigger[]>] [<CommonParameters>]
examples:
- title: 'Example 1: Define a stop action for a Trace Session'
  code: |-
    PS C:\> $TraceSession01 = New-PefTraceSession -Mode Circular -Path "C:\Traces\Result.matu" -Name ".\Trace01.matu" -SaveOnStop
    PS C:\> Add-PefMessageSource -PEFSession $TraceSession01 -Source "Microsoft-Pef-WFP-MessageProvider"
    PS C:\> $Trigger01 = New-PefMessageTrigger -Filter "icmp"
    PS C:\> Stop-PefTraceSession -PEFSession $TraceSession01 -Trigger $Trigger01
    PS C:\> Start-PefTraceSession -PEFSession $TraceSession01
  description: |-
    This example creates a PEF Trace Session that includes a stop action.

    The first command creates a Trace Session and stores it in the **$TraceSession01** variable.
    This command also specifies the Circular capture mode.
    The command uses the **SaveOnStop** parameter and specifies an input file containing message data for the Trace Session as Trace01.matu, located in the current directory, and an output file to contain the captured data, Result.matu, also in the current directory.

    The second command uses the Add-PefMessageSource cmdlet to specify a provider for the Trace Session object stored in the **$TraceSession01** variable.

    The third command uses the New-PefMessageTrigger  cmdlet to create a message trigger object and stores it in the **$Trigger01** variable.

    The fourth command creates a stop action for the Trace Session stored in the **$TraceSession01** variable and specifies the trigger stored in the **$Trigger01** variable.

    The fifth command uses the Start-PefTraceSession cmdlet to start the PEF Trace Session stored in the **$TraceSession01** variable.
  summary: ""
parameters:
- type: <xref href="IPpkTraceSession" data-throw-if-not-resolved="False" />
  name: PEFSession
  isRequired: true
  description: |+
    Specifies an object that contains a Trace Session.
    To create a Trace Session, use the New-PefTraceSession cmdlet.

  defaultValue: None
  pipelineInput: true
  position: "0"
  aliases: ""
  parameterValueGroup: ""
- type: <xref href="Trigger" data-throw-if-not-resolved="False" /><span>[</span><span>]</span>
  name: Trigger
  description: |+
    Specifies an array of **Trigger** objects.
    When one of these triggers runs, the action stops the Trace Session.

  defaultValue: None
  position: Named
  aliases: ""
  parameterValueGroup: ""
uid: PEF.Stop-PefTraceSession
name: Stop-PefTraceSession
description: |-
  The **Stop-PefTraceSession** cmdlet creates an action that stops a Protocol Engineering Framework (PEF) Trace Session.
  You can also specify a trigger that causes the Trace Session to stop.
  Use this cmdlet to define a stop action before you start a PEF Trace Session.

  When a Trace Session stops, the session disposes of all message data and any other information.
  To store the message data from theTrace Session, use the **SaveOnStop** parameter when you create the Trace Session object with the New-PefTraceSession cmdlet.
  You can also use the Save-PefDataCollection cmdlet to save the message data.
metadata:
  external help file: Microsoft.Protocols.Tools.PowerShell.dll-Help.xml
  Module Name: PEF
  ms.date: 10/30/2017
  online version: https://docs.microsoft.com/powershell/module/pef/stop-peftracesession?view=windowsserver2012r2-ps&wt.mc_id=ps-gethelp
  schema: 2.0.0
  title: Stop-PefTraceSession
