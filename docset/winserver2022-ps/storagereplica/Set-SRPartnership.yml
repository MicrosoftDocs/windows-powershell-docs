### YamlMime:PowershellCmdlet
summary: |-
  Modifies a replication partnership between two replication groups.
module: StorageReplica
notes: ""
inputs:
- name: <xref href="System.String" data-throw-if-not-resolved="False" />
  description: ""
- name: <xref href="System.String" data-throw-if-not-resolved="False" /><span>[</span><span>]</span>
  description: ""
- name: <xref href="System.UInt64" data-throw-if-not-resolved="False" />
  description: ""
outputs:
- name: <xref href="System.Object" data-throw-if-not-resolved="False" />
  description: ""
links:
- text: Get-SRGroup
  href: ./Get-SRGroup.yml
- text: Get-SRPartnership
  href: ./Get-SRPartnership.yml
- text: New-SRPartnership
  href: ./New-SRPartnership.yml
- text: Remove-SRPartnership
  href: ./Remove-SRPartnership.yml
syntaxes:
- >-
  Set-SRPartnership [[-SourceComputerName] <String>] [-SourceRGName] <String>

   [-SourceAddVolumePartnership] <String[]> [-DestinationComputerName] <String>

   [-DestinationRGName] <String> [-DestinationAddVolumePartnership] <String[]> [-Seeded] [-Force]

   [-CimSession <CimSession[]>] [-ThrottleLimit <Int32>] [-AsJob] [-WhatIf] [-Confirm]

   [<CommonParameters>]
- >-
  Set-SRPartnership [[-SourceComputerName] <String>] [-SourceRGName] <String>

   [-DestinationComputerName] <String> [-DestinationRGName] <String>

   [[-ReplicationMode] <ReplicationMode>] [[-LogSizeInBytes] <UInt64>] [[-AsyncRPO] <UInt32>]

   [[-Encryption] <Boolean>] [[-Compression] <Boolean>] [-CimSession <CimSession[]>]

   [-ThrottleLimit <Int32>] [-AsJob] [-WhatIf] [-Confirm] [<CommonParameters>]
- >-
  Set-SRPartnership [-SourceRGName] <String> [-DestinationComputerName] <String>

   [-DestinationRGName] <String> [-Force] [[-NewSourceComputerName] <String>]

   [-CimSession <CimSession[]>] [-ThrottleLimit <Int32>] [-AsJob] [-WhatIf] [-Confirm]

   [<CommonParameters>]
examples:
- title: 'Example 1: Reverse replication direction'
  code: |-
    $Parameters = @{
        NewSourceComputerName = 'SR-SRV06'
        SourceRGName = 'ReplicationGroup02'
        DestinationComputerName = 'SR-SRV05'
        DestinationRGName = 'ReplicationGroup01'
        Confirm = $False
    }
    Set-SRPartnership @Parameters
  description: |-
    This example changes the replication direction without user confirmation, for example after a
    disaster recovery event has occurred. The previous source replication group named ReplicationGroup01
    on previous source server SR-SRV05 becomes the new destination for ReplicationGroup02 on SR-SRV06.
    Replication is now reversed. You must direct any applications or users attempting to read or write
    against SR-SRV05 to SR-SRV06.

    This example uses splatting to pass parameter values from the `$Parameters` variable to the command.
    Learn more about [Splatting](/powershell/module/microsoft.powershell.core/about/about_splatting).
  summary: ""
- title: 'Example 2: Change size of log'
  code: |-
    $Parameters = @{
        SourceComputerName = 'SR-SRV05'
        SourceRGName = 'ReplicationGroup01'
        DestinationComputerName = 'SR-SRV06'
        DestinationRGName = 'ReplicationGroup02'
        LogSizeInBytes = '32GB'
    }
    Set-SRPartnership @Parameters
    Get-SRPartnership | Get-SRGroup
  description: |-
    The example changes the log from its default size of 8GB to 32GB, for the partnership between
    SR-SRV05 and SR-SRV06.

    This example uses splatting to pass parameter values from the `$Parameters` variable to the command.
    Learn more about [Splatting](/powershell/module/microsoft.powershell.core/about/about_splatting).
  summary: ""
- title: 'Example 3: Change to asynchronous mode'
  code: |-
    $Parameters = @{
        SourceComputerName = 'SR-SRV05'
        SourceRGName = 'ReplicationGroup01'
        ReplicationMode = 'Asynchronous'
        DestinationComputerName = 'SR-SRV06'
        DestinationRGName = 'ReplicationGroup02'
    }
    Set-SRPartnership @Parameters
  description: |-
    This example changes the replication mode from synchronous to asynchronous. A warning will be
    generated by the setting being applied to both replication groups.

    This example uses splatting to pass parameter values from the `$Parameters` variable to the command.
    Learn more about [Splatting](/powershell/module/microsoft.powershell.core/about/about_splatting).
  summary: ""
- title: 'Example 4: Display replicas after a change'
  code: |-
    $Parameters = @{
        SourceComputerName = 'SR-SRV05'
        SourceRGName = 'ReplicationGroup01'
        SourceAddVolumePartnership = 'F:','G:'
        DestinationComputerName = 'SR-SRV06'
        DestinationRGName = 'ReplicationGroup02'
        DestinationAddVolumePartnership = 'F:','G:'
    }
    Set-SRPartnership @Parameters
    (Get-SRGroup).replicas
  description: |-
    The first command changes the partnership for the servers named SR-SRV05 and SR-SRV06.The second
    command gets all replication groups for the current computer by using the `Get-SRGroup` cmdlet. The
    command displays all the replicas.

    This example uses splatting to pass parameter values from the `$Parameters` variable to the command.
    Learn more about [Splatting](/powershell/module/microsoft.powershell.core/about/about_splatting).
  summary: ""
parameters:
- type: <xref href="SwitchParameter" data-throw-if-not-resolved="False" />
  name: AsJob
  description: |+
    Runs the cmdlet as a background job. Use this parameter to run commands that take a long time to
    complete.

  defaultValue: None
  position: Named
  aliases: ""
  parameterValueGroup: ""
- type: <xref href="UInt32" data-throw-if-not-resolved="False" />
  name: AsyncRPO
  description: |+
    Specifies the maximum difference in time that data for an asynchronous partnership can be different
    between source and destination. This is a Recovery Point Objective. The default value is 30 seconds.

    After this time is exceeded, the source server alerts the Health Service on clusters. It logs event
    1239 in the Storage Replica Admin event log channel. If the RPO time is lower than the configured
    time, event 1240 is logged. Changing this value modifies monitoring and logging. It does not affect
    replication or Input/Output.

  defaultValue: None
  position: "51"
  aliases: RPO
  parameterValueGroup: ""
- type: <xref href="CimSession" data-throw-if-not-resolved="False" /><span>[</span><span>]</span>
  name: CimSession
  description: |+
    Runs the cmdlet in a remote session or on a remote computer. Enter a computer name or a session
    object, such as the output of a [New-CimSession](https://go.microsoft.com/fwlink/p/?LinkId=227967)
    or [Get-CimSession](https://go.microsoft.com/fwlink/p/?LinkId=227966) cmdlet. The default is the
    current session on the local computer.

  defaultValue: None
  position: Named
  aliases: Session
  parameterValueGroup: ""
- type: <xref href="Boolean" data-throw-if-not-resolved="False" />
  name: Compression
  description: |+
    Indicates that the connections in this partnership should use SMB compression for data transfer.
    This parameter only applies to
    [Azure Stack HCI version 22H2](https://azure.microsoft.com/updates/public-preview-azure-stack-hci-version-22h2/)
    or later, and Windows Server Datacenter: Azure Edition beginning with the 2022-09 Cumulative
    Update for Microsoft server operating system version 21H2 for x64-based Systems
    ([KB5017381](https://support.microsoft.com/help/5017381)).

  defaultValue: None
  position: "53"
  aliases: CMP
  parameterValueGroup: ""
- type: <xref href="SwitchParameter" data-throw-if-not-resolved="False" />
  name: Confirm
  description: |+
    Prompts you for confirmation before running the cmdlet.

  defaultValue: "False"
  position: Named
  aliases: cf
  parameterValueGroup: ""
- type: <xref href="String" data-throw-if-not-resolved="False" /><span>[</span><span>]</span>
  name: DestinationAddVolumePartnership
  isRequired: true
  description: |+
    Specifies an array of drive letters or mount point paths of partitions to add to the existing
    replication group. You cannot specify paths already added to the replication group.

    This list is ordered. The order of volumes determines the order of replication. For more
    information, see the **DestinationVolumeName** parameter of the `New-SRPartnership` cmdlet.

    We do not recommend replicating different drive letters or mount point paths.
    The practice can cause application failures because of stored settings after a failover occurs.

  defaultValue: None
  pipelineInput: true
  position: "6"
  aliases: DAV
  parameterValueGroup: ""
- type: <xref href="String" data-throw-if-not-resolved="False" />
  name: DestinationComputerName
  isRequired: true
  description: |+
    Specifies a single replica host computer NetBIOS name or fully qualified domain name (FQDN) of the
    destination computer.

  defaultValue: None
  pipelineInput: true
  position: "3"
  aliases: DCN
  parameterValueGroup: ""
- type: <xref href="String" data-throw-if-not-resolved="False" />
  name: DestinationRGName
  isRequired: true
  description: |+
    Specifies the name of the destination replication group.

  defaultValue: None
  pipelineInput: true
  position: "5"
  aliases: DGN
  parameterValueGroup: ""
- type: <xref href="Boolean" data-throw-if-not-resolved="False" />
  name: Encryption
  description: |+
    Indicates that the connections on this partnership should be encrypted by using SMB AES-128-GCM.
    Enabling encryption can protect Storage Replica block transfers from man-in-the-middle interception
    or reading. Enabling encryption can decrease replication and write Input/Output performance.

  defaultValue: None
  position: "52"
  aliases: ENC
  parameterValueGroup: ""
- type: <xref href="SwitchParameter" data-throw-if-not-resolved="False" />
  name: Force
  description: |+
    Forces the command to run without asking for user confirmation.

  defaultValue: None
  position: "100"
  aliases: F
  parameterValueGroup: ""
- type: <xref href="UInt64" data-throw-if-not-resolved="False" />
  name: LogSizeInBytes
  description: |+
    Specifies the aggregate size of log files on each server in the replication group for the volumes
    that are associated with this replication group. The minimum size 512MB. You can specify a value by
    using the Windows PowerShell byte conversion capability, such as 4GB or 3200MB. A value that is too
    small may cause decreased replication performance or increased recovery time after an interruption
    between computers.

  defaultValue: None
  pipelineInput: true
  position: "50"
  aliases: LS
  parameterValueGroup: ""
- type: <xref href="String" data-throw-if-not-resolved="False" />
  name: NewSourceComputerName
  description: |+
    Specifies the new source of replication. This parameter changes the direction of replication for the
    source computer and the source replication group. When changed, replication stops originating on the
    current source and moves to the new source.

    This operation is very likely to disrupt access to data. There is a time when neither volumes are
    writable and when clients and applications might still access the previously writable source volume.
    You may also have to reconfigure applications and repoint users to this new location, using
    technologies such as DFS Namespaces. When switching asynchronously-replicated volumes, to avoid data
    loss, you must first make sure that user and application data is quiescent.

  defaultValue: None
  pipelineInput: true
  position: "0"
  aliases: NSCN
  parameterValueGroup: ""
- type: <xref href="ReplicationMode" data-throw-if-not-resolved="False" />
  name: ReplicationMode
  description: |+
    Specifies the desired mode of replication for this source and destination pair. The acceptable
    values for this parameter are:

    - Synchronous or 1. The synchronous mode requires all writes to commit on the destination server and
      commit on the source server, which guarantees data integrity between computers.
    - Asynchronous or 2. The asynchronous mode writes to the source server without waiting for the
      server, which allows for replication over high latency, geographic networks.

    The default value is synchronous. The default asynchronous recovery point alert time is 30 seconds.
    You can modify it by using this cmdlet. The alert time has no effect on replication behavior, only
    on reporting.

  defaultValue: None
  position: "8"
  aliases: RM
  parameterValueGroup: Synchronous, Asynchronous
- type: <xref href="SwitchParameter" data-throw-if-not-resolved="False" />
  name: Seeded
  description: |+
    Indicates that the destination server contains a seeded copy of the data from the source server.
    Seeded data is defined as a copy of data from the source server that has a high similarity, such as
    mostly empty blocks, restoring a recent backup, or shipping cloned copies of disks to the
    destination server.

    Seeding is most effective when using a previous copy of the storage, such as a split mirror or
    previously replicated drives, or when the storage is mostly empty and was always empty, such as a
    recently initialized drive with a newly formatted volume. Seeding is somewhat effective with data
    that came from a backup restore or a complete tree copy of data or from copies of very large files.

    Seeding is least effective when copying many small files from some random locations to some other
    random locations. Storage Replica automatically uses seeding when it restarts replication after a
    long outage that wrapped the logs.

  defaultValue: None
  position: "9"
  aliases: S
  parameterValueGroup: ""
- type: <xref href="String" data-throw-if-not-resolved="False" /><span>[</span><span>]</span>
  name: SourceAddVolumePartnership
  isRequired: true
  description: |+
    Specifies an array of drive letters or mount point paths of partitions to add to the existing
    replication group. You cannot specify paths already added to the replication group.

    This is an ordered list. The order of volumes determines the order of replication. For more
    information, see the **DestinationVolumeName** parameter of the `New-SRPartnership` cmdlet.

  defaultValue: None
  pipelineInput: true
  position: "2"
  aliases: SAV
  parameterValueGroup: ""
- type: <xref href="String" data-throw-if-not-resolved="False" />
  name: SourceComputerName
  description: |+
    Specifies a single replica host computer NetBIOS name or FQDN of the source computer.
    The default value is the local computer.

  defaultValue: None
  pipelineInput: true
  position: "0"
  aliases: SCN
  parameterValueGroup: ""
- type: <xref href="String" data-throw-if-not-resolved="False" />
  name: SourceRGName
  isRequired: true
  description: |+
    Specifies the name of the source replication group.

  defaultValue: None
  pipelineInput: true
  position: "1"
  aliases: SGN
  parameterValueGroup: ""
- type: <xref href="Int32" data-throw-if-not-resolved="False" />
  name: ThrottleLimit
  description: |+
    Specifies the maximum number of concurrent operations that can be established to run the cmdlet. If
    this parameter is omitted or a value of `0` is entered, then Windows PowerShell® calculates an
    optimum throttle limit for the cmdlet based on the number of CIM cmdlets that are running on the
    computer. The throttle limit applies only to the current cmdlet, not to the session or to the
    computer.

  defaultValue: None
  position: Named
  aliases: ""
  parameterValueGroup: ""
- type: <xref href="SwitchParameter" data-throw-if-not-resolved="False" />
  name: WhatIf
  description: |+
    Shows what would happen if the cmdlet runs.
    The cmdlet is not run.

  defaultValue: "False"
  position: Named
  aliases: wi
  parameterValueGroup: ""
uid: StorageReplica.Set-SRPartnership
name: Set-SRPartnership
description: |-
  The `Set-SRPartnership` cmdlet modifies a replication partnership between two existing replication
  groups. You can use this cmdlet to add replicated volumes. You can also change the direction of
  replication which makes a source volume into a destination volume.

  > [!NOTE]
  > The **Compression** parameter is only available in
  > [Azure Stack HCI version 22H2](https://azure.microsoft.com/updates/public-preview-azure-stack-hci-version-22h2/) or later,
  > and Windows Server Datacenter: Azure Edition beginning with the 2022-09 Cumulative Update for Microsoft
  > server operating system version 21H2 for x64-based Systems
  > ([KB5017381](https://support.microsoft.com/help/5017381)).
metadata:
  description: Use this topic to help manage Windows and Windows Server technologies with Windows PowerShell.
  external help file: MSFT_WvrAdminTasks.cdxml-help.xml
  Module Name: StorageReplica
  ms.date: 10/04/2022
  online version: https://learn.microsoft.com/powershell/module/storagereplica/set-srpartnership?view=windowsserver2022-ps&wt.mc_id=ps-gethelp
  schema: 2.0.0
  title: Set-SRPartnership
